<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width initial-scale=1">

<meta property="og:title" content="Swift - Alamofire와 Escaping">
<title>Swift - Alamofire와 Escaping</title>
<meta property="og:description" content="자주 반복되는 Alamofire를 함수로 만들자. feat.EscapingAlamofire라는 좋은 라이브러리를 쓰다가 보면 새로운 swift파일을 만들때마다 반복적으로 쓴다는 생각이 든다.그래서 함수로 만들면 좋겠다! 라고 생각했다가, 졸업작품 당시 포기했다.포기한 과정을 보기전...">
<meta property="og:url" content="http://localhost:4000/articles/2018/07/29/swift-Alamofire%EC%99%80-Escaping.html">
<meta property="og:site_name" content="JS Blog">
<meta property="og:locale" content="kr">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@">
<meta name="twitter:creator" content="@">
<meta name="twitter:title" content="Swift - Alamofire와 Escaping">
<meta name="twitter:description" content="자주 반복되는 Alamofire를 함수로 만들자. feat.EscapingAlamofire라는 좋은 라이브러리를 쓰다가 보면 새로운 swift파일을 만들때마다 반복적으로 쓴다는 생각이 든다.그래서 함수로 만들면 좋겠다! 라고 생각했다가, 졸업작품 당시 포기했다.포기한 과정을 보기전...">
<meta name="twitter:url" content="http://localhost:4000/articles/2018/07/29/swift-Alamofire%EC%99%80-Escaping.html">

<meta name="keywords" content="Swift, ObjectiveC, iOS">

<link rel="icon" href="/assets/favi.ico">
<link rel="stylesheet" href="/css/main.css">
<link rel="canonical" href="http://localhost:4000/articles/2018/07/29/swift-Alamofire%EC%99%80-Escaping.html">
<link rel="alternate" type="application/atom+xml" title="JS Blog" href="http://localhost:4000/feed.xml" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<script language="Javascript" type="text/javascript">
function search_google()
{
  var query = document.getElementById("google-search").value;
  window.open("http://google.com/search?q=" + query
      + "%20site:" + "http://localhost:4000");
}
</script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-121626260-1', 'auto');
ga('send', 'pageview');

</script>


<script type='text/javascript'>
var blocklink = ['http://humanorightswatch.org','http://o-o-6-o-o.com','http://darodar.com','http://blackhatworth.com','http://hulfingtonpost.com','http://bestwebsitesawards.com','http://darodar.com','http://buttons-for-website.com','http://ilovevitaly.co','http://semalt.com','http://priceg.com','http://simple-share-buttons.com','http://googlsucks.com','http://4webmasters.org','http://aliexpress.com','http://addons.mozilla.org/en-US/firefox/addon/ilovevitaly/','http://free-share-buttons.com','http://buttons-for-your-website.com','http://theguardlan.com','http://buy-cheap-online.info','http://best-seo-offer.com','http://4webmasters.org','http://trafficmonetize.org','http://howtostopreferralspam.eu','http://ilovevitaly.com','http://sanjosestartups.com','http://free-social-buttons.com','http://best-seo-offer.com','http://guardlink.org','http://www.event-tracking.com','http://www3.free-social-buttons.com','http://www1.free-social-buttons.com','http://www2.free-social-buttons.com','http://websites-reviews.com','http://floating-share-buttons.com','http://satellite.maps.ilovevitaly.com','http://free-social-buttons.com','http://www.event-tracking.com','http://erot.co'];
for (var b = blocklink.length; b--;) {
  if (document.referrer.match(blocklink[b]))
    window.location = "http://www.google.com";
}
</script>




</head>


<body>

<div class="container">

  <header class="site-header">

  <div class="wrapper">

    <h1 class="site-title"><a href="/">JS Blog</a></h1>
    <h3 class="site-meta">Developer story who love Swift</h3>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
        
        <a class="page-link" href="/">홈</a>
        
        
        
        <a class="page-link" href="/about/">소개</a>
        
        
        
        <a class="page-link" href="/archives/">모든 게시물</a>
        
        
        
        <a class="page-link" href="/categories/">카테고리</a>
        
        
        
        <a class="page-link" href="/tags/">태그</a>
        
        
        
        <a class="page-link" href="/guestbook/">방명록</a>
        
        
        
        <a class="page-link" href="/feed.xml">구독하기</a>
        
        
        
        
        
        
        
        
        
        
      </div>
    </nav>

  </div>

</header>


    

  <div class="page-content col-sm-8">
    <div class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 itemprop="name" class="post-title">Swift - Alamofire와 Escaping</h1>
    <meta itemprop="keywords" content="Swift,Alamofire,Escaping" />
    <p class="post-meta">
    카테고리: 
    
    <a href="/categories/#articles">articles</a>
     
    
    태그: 
    
    <a href="/tags/#Swift" title="Swift">Swift</a>, 
    
    <a href="/tags/#Alamofire" title="Alamofire">Alamofire</a>, 
    
    <a href="/tags/#Escaping" title="Escaping">Escaping</a>
    
    
    <time itemprop="datePublished" datetime="2018-07-29">
    작성일: Jul 29, 2018
    </time>
    </p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <p>자주 반복되는 Alamofire를 함수로 만들자. feat.Escaping
<br /></p>

<p>Alamofire라는 좋은 라이브러리를 쓰다가 보면 새로운 swift파일을 만들때마다 반복적으로 쓴다는 생각이 든다.</p>

<p>그래서 함수로 만들면 좋겠다! 라고 생각했다가, 졸업작품 당시 포기했다.</p>

<p>포기한 과정을 보기전에 오늘의 구조 먼저, 첨부</p>

<p><img src="/assets/img/post/2018-07-29/img1.png" alt="" /></p>

<p>스토리보드도 심플, 코드도 심플, 화면도 심플한 상태이다</p>

<p><br /></p>

<h3 id="코드-구성">코드 구성</h3>

<ol>
  <li>Alamofire를 사용하기 위해 import</li>
  <li>사용될 함수</li>
  <li>url을 선언과 초기화</li>
  <li>통신 성공시 obj 라는 이름의 Any타입을 가진 데이터를 가져오고 출력
    <ul>
      <li>출력 값: 오른쪽 하단</li>
    </ul>
  </li>
  <li>Any 타입 데이터를 딕셔너리로 캐스팅</li>
  <li>해당 딕셔너리중 ‘text’라는 키의 데이터를 String형으로 캐스팅
    <ul>
      <li>값: “Server Text”라는 문자열</li>
    </ul>
  </li>
  <li>Label에 적용</li>
</ol>

<p>저번편에 간단하게 설명을 참고하면 아주 간단한 코드.</p>

<p><a href="https://jiseobkim.github.io/2018/07/21/swift-Alamofire와-Codable.html">참고: Alamofire와 Codable</a></p>

<p>그런데, 만약 다른 통신을 한다고 하면 2번 부분에서 굉장히 중복이 많이 일어난다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 요청</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Alamofire</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1">// 응답</span>
<span class="n">request</span><span class="o">.</span><span class="n">responseJSON</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="k">in</span>
<span class="c1">// Switch문 사용</span>
<span class="k">switch</span> <span class="n">response</span><span class="o">.</span><span class="n">result</span> <span class="p">{</span>                      
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">obj</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">e</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>위의 코드를 보자,</p>

<ol>
  <li>요청</li>
  <li>응답</li>
  <li>분기문</li>
</ol>

<p>이것들은 분명 반복이 된다.</p>

<p>앱정보, 사용자 정보, 기타등등  통신할때마다 똑같은 코드를 쳐야한다. 그래서 나는 졸업작품 당시 간소화 시키고 싶었다.</p>

<p>내가 필요한건 <strong>nsDic</strong> 였었다. 그래서 아래와 같은 코드를 사용했었다.</p>

<p>(<strong>주의: 안되는 코드임</strong>)</p>

<p><img src="/assets/img/post/2018-07-29/img2.png" alt="" /></p>

<p>1번을 보면 어떤 클래스라도 접근할수 있는 전역함수가 있다.</p>

<p>여기서 중요한건 return 값이 존재하며 타입은 <strong>NSDictionary?</strong> 이다. 위에 쓴바와 같이 원하던 nsDic의 타입이다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1-1. 필요한 nsDic이 될값</span>
<span class="k">var</span> <span class="nv">returnValue</span><span class="p">:</span> <span class="kt">NSDictionary</span><span class="p">?</span>
</code></pre></div></div>

<p>돌려줄 값의 타입을 옵셔널로 지정해주고</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 5. returnValue에 지정</span>
<span class="n">returnValue</span> <span class="o">=</span> <span class="n">nsDic</span>
</code></pre></div></div>

<p>통신을 통해 받아서 캐스팅한 nsDic 값을 returnValue의 값으로 넣어주고</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 6. 돌려주기</span>
<span class="k">return</span> <span class="n">returnValue</span>
</code></pre></div></div>

<p>6번에서 return 해준다!</p>

<p><br /></p>

<p>이게 과연 될까? <strong>결론은 안된다</strong></p>

<p>위 이미지 하단의 콘솔창을 보면 <strong>nil</strong> 임을 알 수 있다.</p>

<p><br /></p>

<h3 id="왜-nil일까">왜 nil일까?</h3>

<p>그 당시 참 멘붕이었는데, 정답은 간단하다. 통신은 얼마나 걸릴지 모른다. 따라서,<strong>비동기</strong>로 진행되야한다.</p>

<p><br /></p>

<h3 id="만약-비동기가-아니라면">만약 비동기가 아니라면??</h3>

<p>앱자체가 멈춰 버릴것이다. 왜냐면 통신이 될때까지 기다렸다가 순차적으로 진행되어야 하기 때문이다.</p>

<p>시간이 좀 지연된다면 사용자는 앱이 죽었나? 라고 생각 할것이다.</p>

<blockquote>
  <p><strong>너는 통신하고 끝나면 할거 하고와 나는 하던일 계속할게</strong> 이런 느낌이랄까?</p>
</blockquote>

<p>그래서 <strong>nil</strong>이 발생한것이다.</p>

<p>사용자가 느끼기엔 충분히 빠른시간안에 표현되었지만 아래코드가 진행될때쯤이면</p>

<p>return은 이미 끝난 후이다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 5. returnValue에 지정</span>
<span class="n">returnValue</span> <span class="o">=</span> <span class="n">nsDic</span> <span class="c1">// 이때, 이미 return은 진행된 상태. 즉, 넣어봤자 소용이 없다.</span>
</code></pre></div></div>

<p>그렇다면 nsDic을 return 값으로 정해주는게 아니라 nsDic을 return 해준다면?</p>

<p><img src="/assets/img/post/2018-07-29/img3.png" alt="" /></p>

<p>안된다. 다른 방식이 필요하다.</p>

<p><br /></p>

<h2 id="escaping">Escaping</h2>

<p>처음엔 이 문법에 대해 도무지 이해가 안갔다. 졸업작품할당시에도 찾았었지만, 시간이 급해서 조금 시도해보다 포기했다.</p>

<p>하지만, 알면 정말 도움이 많이 된다. 혹여나 읽는 분이 계시다면 이리 저리 시도해서 꼭 성공하시길.</p>

<p>일단 코드를 보자.</p>

<p><img src="/assets/img/post/2018-07-29/img4.png" alt="" /></p>

<p>특별히 0번이라 썼다. 책으로만 공부했다면, 정말 정말 생소할 모습일것이다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">useEscaping</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="p">(</span><span class="kt">NSDictionary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{}</span>
</code></pre></div></div>

<p>혹시, 이런 모습이면 조금이나마 익숙하다. 스위프트는 함수형 언어라고도 가능한데, 그 이유는 스위프트에서 함수는 일급함수에 속하기 때문이다. 여러가지 조건이 있지만 복잡하니, 나중에 더 알아보는걸로 하고. 여기서 관련된 일급 함수 조건들만 말해보면</p>

<ol>
  <li>인자 값으로 함수를 전달할 수 있다.</li>
  <li>반환 값으로 함수를 전달할 수 있다.</li>
</ol>

<p>두가지 정도? 저기서 <strong>handler</strong> 라는 인자는 타입이 <strong>NSDictionary</strong>만 받는게 아니라 <strong>return</strong>이 있다. 이건 누가봐도 함수다. 이런식으로 인자값으로 함수를 받았다. 반환값으로도 가능하고! 일급함수란 표현도 중요하지만 그 내용인 함수를 받았다는게 중요하다. 그렇다면 <strong><code class="highlighter-rouge">@escaping</code></strong> 이 의미하는것은 무엇일까</p>

<blockquote>
  <p>handler 라는 표현은 보통 ‘다루다’로 사용되고 stackOverFlow 같은 곳에서 보면</p>

  <p>관련 자료에서 종종 인자값에 <strong><code class="highlighter-rouge">completionHandler</code></strong> , <strong><code class="highlighter-rouge">completion</code></strong>라는 단어를 많이 쓰는데,</p>

  <p>이는 완료후 처리할 작업, 완료후 다룰것 이라고 생각하면 좀더 편했던것 같다.</p>
</blockquote>

<p><br /></p>

<h3 id="escaping-1">@escaping</h3>

<p>이름부터가 탈출이다. 나는 이렇게 이해하고 있다. 현재 함수로부터 도망쳐 나온다. 하지만, 그때 NSDictionary를 가지고 도망친다. 이게 포인트다, 다르지만 비슷하게 생각할 수 있는건, <strong>NSDictionary</strong> 값을 리턴해준다고도 볼 수 있다.</p>

<p>쓰는 방식은 이미 많이들 접했을 것이다. 비슷한 문법을 보자</p>

<p><img src="/assets/img/post/2018-07-29/img5.png" alt="" /></p>

<p>1번의 경우는 애니메이션 효과를 사용할때 자주 사용하는 문법이다.</p>

<p>2번의 경우 포스팅에 자주 나온 Alamofire에서 응답 값을 받았을때 처리하는 부분에서 나온것이다.</p>

<p>저런 문법을 만들려면 필요한것은 @escaping을 쓰는 것이라는 결론이 나왔다!</p>

<p>각각의 차이점을 보자</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1. Animation ( 인자: o , 반환: x)</span>
<span class="p">((</span><span class="kt">Bool</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span>
<span class="c1">// 2. Alamofire Response ( 인자: o , 반환: x)</span>
<span class="p">(</span><span class="kt">DataResponse</span><span class="o">&lt;</span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
<span class="c1">// 3. Use Escaping ( 인자: o , 반환: x)</span>
<span class="p">(</span><span class="kt">NSDictionary</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p>쉬운 순서대로 정리했다.  공통점은 반환 값이 전부 없다는것.</p>

<h3 id="uiview-animation">UIView Animation</h3>

<p>1번의 경우 애니메이션 사용할때 생각을 해보자,</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">UIView</span><span class="o">.</span><span class="nf">animate</span><span class="p">(</span><span class="nv">withDuration</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">animations</span><span class="p">:</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">true</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"success"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>자신이 정한 시간(여기선 2초)동안 <strong>animations</strong> 의 내용을 수행하게 된다, 그리고 그 작업이 끝난뒤에 할일은 <strong>completion내용이</strong> 된다. 저기서 뒤에 물음표가 붙어있는데, <strong>nil이</strong> 될수 있다는 것이다. 즉 효과만 주고 그뒤에 다른 작업은 안해도 된다는것! 그렇기에 <strong>animation에</strong> 더 들어가보면 default값으로 <strong>nil이</strong> 들어가있다.</p>

<p><img src="/assets/img/post/2018-07-29/img6.png" alt="" /></p>

<p><br /></p>

<h3 id="alamofire-response">Alamofire Response</h3>

<p>다시 본론으로 들어가서 2번째 경우, 데이터 타입이 DataResponse라는 것이고 뒤에 꺽쇠로 된건 <strong>Generic</strong>을 의미한다.</p>

<p>Generic도 나중에 다루기로하고, 함수나 클래스 구조체 등등 하나 선언해서 여러 타입(String, Int 등등)을 대응 한다 생각하고 넘어가자.</p>

<p>여기서 중요한건, 통신 후 <strong>DataResponse라는 타입을 가진 데이터를 받아와서 내가 사용</strong>했다는 것이다.</p>

<p>이게 바로 우리가 필요한것이다. <strong>nsDictionary로 된 데이터를 받아와서 표현</strong>하고 싶은 것이다.</p>

<p><br /></p>

<h3 id="escaping-2">Escaping</h3>

<p>사용법은 위의 Alamofire보다 훨씬 간단하다.</p>

<p><img src="/assets/img/post/2018-07-29/img7.png" alt="" /></p>

<p>2-2 부분이 전부이다. 받아온 <strong>NSDictionary</strong> 타입을 가진 데이터 이름을 <strong><code class="highlighter-rouge">nsDic</code></strong> 이라 이름을 붙여주고 정말 딕셔너리 사용하듯 사용하면 끝이다.</p>

<p>그 아래에 쓴것은 위에서 실패했던 방식인 NSDictionary를 return 해주는 방식의 함수를 다시 사용 한것이다.</p>

<p>근데 아래 콘솔창을 보면 당연하지만 재미난 출력물이 보인다.</p>

<p>사용한건 <strong>escaping</strong> 방식이 먼저지만, 출력된건  <strong>return</strong> 방식을 사용 한것이 먼저이다. 이제는 당연하다고 생각이 들것이다.</p>

<p>네트워크가 아무리 빠르다 한들 로컬의 코드진행보다 빠를리가… 그리고 비동기방식이기 때문에 가능한일!</p>

<p><br /></p>

<h2 id="번외-공통으로-사용하는건-좋다-그렇지만-통신-실패시엔-다르게-대응하고-싶은데-할-경우">번외: 공통으로 사용하는건 좋다! 그렇지만, 통신 실패시엔 다르게 대응하고 싶은데? 할 경우</h2>

<p>위에 잠시 언급한 일급 함수의 특징을 사용하면 간단하게 해결! 내가 하고 싶은 함수를 만들고, 실패시에 작동하게 하면 그만</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">useEscaping</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">whenIfFailed</span><span class="p">:</span> <span class="p">(),</span> <span class="nv">handler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">NSDictionary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Alamofire</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="n">request</span><span class="o">.</span><span class="n">responseJSON</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">switch</span> <span class="n">response</span><span class="o">.</span><span class="n">result</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">obj</span><span class="p">):</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">nsDic</span> <span class="o">=</span> <span class="n">obj</span> <span class="k">as?</span> <span class="kt">NSDictionary</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
            <span class="nf">handler</span><span class="p">(</span><span class="n">nsDic</span><span class="p">)</span>
            
        <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">e</span><span class="p">):</span>
            <span class="c1">// 통신 실패시</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
            <span class="n">whenIfFailed</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>위와 같이 적어 주자. 하나가 추가 되었다. <strong><code class="highlighter-rouge">whenIfFailed</code></strong>  라는 함수 타입의 인자이다. 그리고 주석 부분에 보면 통신 실패시 작동하게 되어 있다.</p>

<p>하지만, 항상 실패에 대응 할필요가 없을 수도 있다. 위 함수안에 동일하게 대응되게 짜둔다면 굳이 그럴 필요 없다. 그러나! 필요한 경우도 있다! 그렇다면 어떻하면 좋을까?  <strong><code class="highlighter-rouge">whenIfFailed</code></strong> 를 옵셔널로 해주고 기본값을 <strong>nil</strong>로 해주자</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">useEscaping</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">whenIfFailed</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">NSDictionary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Alamofire</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="n">request</span><span class="o">.</span><span class="n">responseJSON</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">switch</span> <span class="n">response</span><span class="o">.</span><span class="n">result</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">obj</span><span class="p">):</span>
            
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">nsDic</span> <span class="o">=</span> <span class="n">obj</span> <span class="k">as?</span> <span class="kt">NSDictionary</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
            <span class="nf">handler</span><span class="p">(</span><span class="n">nsDic</span><span class="p">)</span>
            
        <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">e</span><span class="p">):</span>
            
            <span class="c1">// 통신 실패시</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
            <span class="nf">whenIfFailed</span><span class="p">?()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong><code class="highlighter-rouge">whenIfFailed</code></strong> 부분이 좀 달라졌다. <strong>(() -&gt; Void)</strong> 는 같은것이다. 하지만 뒤에 물음표가 붙어 있고, 기본 값이 <strong>nil</strong> 로 되어있다.</p>

<p>즉, 필요 없으면 안써두 된다는 것이다. 그 결과 아래쪽에 보면 <strong><code class="highlighter-rouge">whenIfFailed</code></strong> 에 물음표가 붙어있고, 이는 nil이면 자동으로 실행 않고 지나가게 된다!</p>

<p>사용은 아래와 같다</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">ifFailed</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"실패했어요"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 함수 사용</span>
<span class="nf">useEscaping</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">whenIfFailed</span><span class="p">:</span> <span class="n">ifFailed</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">nsDic</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">text</span> <span class="o">=</span> <span class="n">nsDic</span><span class="p">[</span><span class="s">"text"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"(Escaping 사용)text: </span><span class="se">\(</span><span class="n">text</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>그런데, 나는 각각에 다르게 반응할거야!! 라고 하면, 각 함수 만드는것도 일이다. 그럴 경우엔 이렇게 해보는건 어떨까</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">useEscaping</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">whenIfFailed</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">NSDictionary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Alamofire</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="n">request</span><span class="o">.</span><span class="n">responseJSON</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">switch</span> <span class="n">response</span><span class="o">.</span><span class="n">result</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">obj</span><span class="p">):</span>
            
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">nsDic</span> <span class="o">=</span> <span class="n">obj</span> <span class="k">as?</span> <span class="kt">NSDictionary</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
            <span class="nf">handler</span><span class="p">(</span><span class="n">nsDic</span><span class="p">)</span>
            
        <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">e</span><span class="p">):</span>
            
            <span class="c1">// 통신 실패시</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
            <span class="nf">whenIfFailed</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>여기서도 <strong>escaping</strong>을 사용했다. 그럼 사용 코드에선?</p>

<p><img src="/assets/img/post/2018-07-29/img8.png" alt="" /></p>

<p>마치 UIView Animation 같다.</p>

<p>값을 채워 넣으면 이렇게</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">useEscaping</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">whenIfFailed</span><span class="p">:</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"실패했어요"</span><span class="p">)</span>
<span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">nsDic</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">text</span> <span class="o">=</span> <span class="n">nsDic</span><span class="p">[</span><span class="s">"text"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"(Escaping 사용)text: </span><span class="se">\(</span><span class="n">text</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>escaping은  알면 알수록 유용하게 쓰이는 것 같다. 좀 더 활용할 곳을 찾아봐야겠다.</p>


  </article>
  <hr />
</div>


<section class="pager">
  <ul>
    
    <li class="previous"><a href="/articles/2018/07/21/swift-Alamofire%EC%99%80-Codable.html" title="Swift - Alamofire와 Codable">&larr; 이전 게시물</a></li>
    
    
    <li class="next"><a href="/articles/2018/08/05/swift-%EC%84%9C%EB%B2%84-%EC%97%B0%EB%8F%99-%EA%B8%B0%EB%B3%B8%EA%B3%BC-Encodable-(Without-Alamofire).html" title="Swift - 서버 연동 기본과 Encodable">다음 게시물 &rarr;</a></li>
    
  </ul>
</section>

<script src="/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://localhost:4000/articles/2018/07/21/swift-Alamofire%EC%99%80-Codable.html';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://localhost:4000/articles/2018/08/05/swift-%EC%84%9C%EB%B2%84-%EC%97%B0%EB%8F%99-%EA%B8%B0%EB%B3%B8%EA%B3%BC-Encodable-(Without-Alamofire).html';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>



<div id="disqus_thread"></div>

<script type="text/javascript">

  var disqus_developer = 1;

var disqus_shortname ='Jiseob Kim';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



    <section class="pager">
  
  
</section>

<script src="/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>



  </div>
  <div class="col-sm-2">
<div class="sidebar-module about">
  <h2>저자 소개</h2>
  <img title="Kim Ji Seob" src="/assets/ItsMe.jpeg" alt="Kim Ji Seob"/>
  <br>
  <span>파릇파릇한 iOS 개발자!</span>
  <br />

  

  Contact Me Via: <br />

  
  <a href="mailto:jiseob812@gmail.com" title="mailto: jiseob812@gmail.com"><i class="fa fa-envelope-square fa-3x"></i></a>&nbsp;
  
  
  <a href="https://github.com/JiSeobKim" title="GithubID: JiSeobKim"><i class="fa fa-github-square fa-3x"></i></a>&nbsp;
  


  

</div>

<div class="sidebar-module">
  <h4>게시물 검색</h4>
  <form onsubmit="search_google()" >
    <input type="text" id="google-search" placeholder="Google search" />
    <input type="submit" name="sa" value="Go" />
  </form>
</div>



<div class="sidebar-module">
  <h4>최근 게시물</h4>
  
  <li>
  <a href="/articles/2018/12/26/Xcode-Cartage.html" title="Xcode_Carthage (서론)" rel="bookmark">Xcode_Carthage (서론)</a>
  </li>
  
  <li>
  <a href="/articles/2018/11/04/swift-Tag.html" title="Swift_Basic - Tag 알아보기" rel="bookmark">Swift_Basic - Tag 알아보기</a>
  </li>
  
  <li>
  <a href="/articles/2018/10/27/swift-NotificationCenter.html" title="Swift - Notification Center" rel="bookmark">Swift - Notification Center</a>
  </li>
  
  <li>
  <a href="/articles/2018/10/05/swift_basic-%ED%83%80%EC%9E%85-%EB%A9%94%EC%86%8C%EB%93%9C-&-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%EB%A9%94%EC%86%8C%EB%93%9C.html" title="Swift_Basic - 타입 메소드 & 인스턴스 메소드" rel="bookmark">Swift_Basic - 타입 메소드 & 인스턴스 메소드</a>
  </li>
  
  <li>
  <a href="/articles/2018/09/16/swift-DelegatePattern2.html" title="Swift - 화면간 데이터 전달. 2편" rel="bookmark">Swift - 화면간 데이터 전달. 2편</a>
  </li>
  
</div>


<div class="sidebar-module">
  <h4>카테고리</h4>
  
  <li><a href="/categories/#articles" title="articles" rel="12">articles (12)</a></li>
  
</div>


<div class="sidebar-module">
  <h4>태그</h4>
  
    <a href="/tags/#Swift" title="Swift" rel="11">Swift</a> &nbsp;
  
    <a href="/tags/#Class" title="Class" rel="2">Class</a> &nbsp;
  
    <a href="/tags/#Struct" title="Struct" rel="1">Struct</a> &nbsp;
  
    <a href="/tags/#값전달" title="값전달" rel="1">값전달</a> &nbsp;
  
    <a href="/tags/#Inherite" title="Inherite" rel="1">Inherite</a> &nbsp;
  
    <a href="/tags/#Alamofire" title="Alamofire" rel="2">Alamofire</a> &nbsp;
  
    <a href="/tags/#Codable" title="Codable" rel="2">Codable</a> &nbsp;
  
    <a href="/tags/#Escaping" title="Escaping" rel="1">Escaping</a> &nbsp;
  
    <a href="/tags/#Network" title="Network" rel="1">Network</a> &nbsp;
  
    <a href="/tags/#Encodable" title="Encodable" rel="1">Encodable</a> &nbsp;
  
    <a href="/tags/#Generic" title="Generic" rel="1">Generic</a> &nbsp;
  
    <a href="/tags/#Delegate Pattern" title="Delegate Pattern" rel="1">Delegate Pattern</a> &nbsp;
  
    <a href="/tags/#Protocol" title="Protocol" rel="1">Protocol</a> &nbsp;
  
    <a href="/tags/#Method" title="Method" rel="1">Method</a> &nbsp;
  
    <a href="/tags/#Type Method" title="Type Method" rel="1">Type Method</a> &nbsp;
  
    <a href="/tags/#Instance Method" title="Instance Method" rel="1">Instance Method</a> &nbsp;
  
    <a href="/tags/#Notification Center" title="Notification Center" rel="1">Notification Center</a> &nbsp;
  
    <a href="/tags/#Tag" title="Tag" rel="1">Tag</a> &nbsp;
  
    <a href="/tags/#Carthage" title="Carthage" rel="1">Carthage</a> &nbsp;
  
    <a href="/tags/#Xcode" title="Xcode" rel="1">Xcode</a> &nbsp;
  
</div>



<div class="sidebar-module">
  <h4>모든 게시물</h4>

  
  
  
  
  
  <li id="2018" > <a href="/archives/#2018">2018</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

</div>


<div class="sidebar-module"> <!-- sidebar-module-inset">-->
  <h4>저작권</h4>

  

  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">
    <img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png">
  </a>
  <br />
  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Attribution-NonCommercial-ShareAlike</a>

  

</div>


</div>


  

  <footer class="site-footer">

  <p>Copyright &copy; <a href="/">JS Blog</a></p>
  <p>Powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a> 
  on 
  <a href="https://github.com/">Github</a>
  | Theme <a href="https://github.com/yulijia/freshman21/">Freshman21</a> Design by <a href="https://yulijia.net">Lijia Yu</a>  


  <div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
    <a title="Back To Top"><img src="/images/topbutton.png"/></a>
  </div>

  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/totop.js"></script>  



</footer>


</div>

</body>

</html>
